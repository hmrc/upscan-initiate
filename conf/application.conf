
# This is the main configuration file for the application.
# ~~~~~

appName=fu-init-upload

play.modules.enabled += "com.kenshoo.play.metrics.PlayModule"

#Required for object based play2.5 applications
play.http.requestHandler = "play.api.http.GlobalSettingsHttpRequestHandler"

# An ApplicationLoader that uses Guice to bootstrap the application.
play.application.loader = "uk.gov.hmrc.play.bootstrap.ApplicationLoader"

# Primary entry point for all HTTP requests on Play applications
play.http.requestHandler = "uk.gov.hmrc.play.bootstrap.http.RequestHandler"

# Provides an implementation of AuditConnector. Use `uk.gov.hmrc.play.bootstrap.AuditModule` or create your own.
# An audit connector must be provided.
play.modules.enabled += "uk.gov.hmrc.play.bootstrap.AuditModule"

# Provides an implementation of MetricsFilter. Use `uk.gov.hmrc.play.graphite.GraphiteMetricsModule` or create your own.
# A metric filter must be provided
play.modules.enabled += "uk.gov.hmrc.play.bootstrap.graphite.GraphiteMetricsModule"

# Provides an implementation and configures all filters required by a Platform frontend microservice.
play.modules.enabled += "uk.gov.hmrc.play.bootstrap.MicroserviceModule"

play.modules.enabled += "S3UploadModule"

play.http.filters = "uk.gov.hmrc.play.bootstrap.filters.MicroserviceFilters"

# Json error handler
play.http.errorHandler = "uk.gov.hmrc.play.bootstrap.http.JsonErrorHandler"

# Session Timeout
# ~~~~
# The default session timeout for the app is 15 minutes (900seconds).
# Updating this is the responsibility of the app - it must issue a new cookie with each request or the session will
# timeout 15 minutes after login (regardless of user activity).
# session.maxAge=900

# Secret key
# ~~~~~
# The secret key is used to secure cryptographics functions.
# If you deploy your application to several instances be sure to use the same key!
application.secret="mKW4mMngaPz1UVOrEkgkJrZT9kloW9Neva5wUFDUq84n9xlz42lQMGrtlrQ2bMF4"

# Session configuration
# ~~~~~
application.session.httpOnly=false

application.session.secure=false

# The application languages
# ~~~~~
application.langs="en"

# Router
# ~~~~~
# Define the Router object to use for this application.
# This router will be looked up first when the application is starting up,
# so make sure this is the entry point.
# Furthermore, it's assumed your route file is named properly.
# So for an application router like `my.application.Router`,
# you may need to define a router file `conf/my.application.routes`.
# Default to Routes in the root package (and conf/routes)
# !!!WARNING!!! DO NOT CHANGE THIS ROUTER
application.router=prod.Routes


# Controller
# ~~~~~
# By default all controllers will have authorisation, logging and 
# auditing (transaction monitoring) enabled.
# The below controllers are the default exceptions to this rule. 

controllers {
  com.kenshoo.play.metrics.MetricsController = {
    needsAuth = false
    needsLogging = false
    needsAuditing = false
  }
  controllers.DeskProController = {
    needsAuth = false
    needsLogging = true
    needsAuditing = true
  }
}


# Evolutions
# ~~~~~
# You can disable evolutions if needed
# evolutionplugin=disabled

# Logger
# ~~~~~
# You can also configure logback (http://logback.qos.ch/), by providing a logger.xml file in the conf directory .

# Root logger:
logger.root=ERROR

# Logger used by the framework:
logger.play=INFO

# Logger provided to your application:
logger.application=DEBUG

# Metrics plugin settings - graphite reporting is configured on a per env basis
metrics {
    name = ${appName}
    rateUnit = SECONDS
    durationUnit = SECONDS
    showSamples = true
    jvm = true
    enabled = true
}


# Microservice specific config

Test {
  auditing {
    enabled=true
    traceRequests=true
    consumer {
      baseUri {
        host = localhost
        port = 11111
      }
    }
  }

  mongodb {
    uri = "mongodb://localhost:27017/hmrcdeskpro"
  }

  microservice {
    metrics {
      graphite {
        enabled = false
      }
      gauges {
        interval = 1 second
      }
    }
    services {

      auth {
        host=localhost
        port=8500
      }

      external-deskpro {
        protocol=http
        host=localhost
        port=8083
        proxy {
          proxyRequiredForThisEnvironment=false
        }
        traceRequests=true
        traceResponses=true
        apiKey {
          id: 2
          code: G44HTTZZDHJ5SXD4QP4TBAW86
        }
      }
    }
  }

  hardCopyPrintTicket.retryInterval = 1 minute

  hardCopyPrintTicket.inProgressRetryAfter = 10 minutes

  hardCopyPrintTicket.emailFrom = "noreply-hard-copy-print-request@tax.service.gov.uk"

  processTickets {
    retryInterval = 1 minute
    inProgressRetryAfter = 10 minutes
    maxRetryCount = 6
  }
  
  userAgentFilter.allowedUserAgents = "ValidTestAgent"

  scheduling {
    processHardCopyPrints {
      initialDelay = 1 second
      interval = 1 second
    }

    processTickets {
      initialDelay = 1 second
      interval = 1 second
    }
    collectMetrics {
      initialDelay = 1 second
      interval = 1 second
    }

  }
}

Dev {
  auditing {
    enabled=true
    traceRequests=true
    consumer {
      baseUri {
        host = localhost
        port = 8100
      }
    }
  }

    mongodb {
        uri = "mongodb://localhost:27017/hmrcdeskpro"
    }

    microservice {
        metrics {
            graphite {
                enabled = false
            }
          gauges {
            interval = 1 second
          }
        }

        services {

            auth {
                host=localhost
                port=8500
            }

            external-deskpro {
                protocol=http
                host=localhost
                port=8083
                proxy {
                  proxyRequiredForThisEnvironment=false
                }
                traceRequests=true
                traceResponses=true
                apiKey {
                  id: 2
                  code: G44HTTZZDHJ5SXD4QP4TBAW86
                }
            }
        }
    }

  hardCopyPrintTicket.retryInterval = 1 minute

  hardCopyPrintTicket.inProgressRetryAfter = 10 minutes

  hardCopyPrintTicket.emailFrom = "noreply-hard-copy-print-request@tax.service.gov.uk"

  processTickets {
    retryInterval = 1 minute
    inProgressRetryAfter = 10 minutes
    maxRetryCount = 6
  }

  scheduling {
    processHardCopyPrints {
      initialDelay = 1 second
      interval = 1 second
    }
    processTickets {
      initialDelay = 1 second
      interval = 1 second
    }
    collectMetrics {
      initialDelay = 1 second
      interval = 1 second
    }
  }
}

Prod {
  auditing {
    enabled = true
    traceRequests = true
    consumer {
      baseUri {
        host = datastream.protected.mdtp
        port = 80
      }
    }
  }

    mongodb {
        uri = "mongodb://dev-app-db-1:27017,dev-app-db-2:27017,dev-app-db-3:27017/hmrcdeskpro"
    }

    microservice {
        metrics {
            graphite {
                host = graphite
                port = 2003
                prefix = play.${appName}.
                enabled = true
            }
            gauges {
              interval = 1 minute
            }
        }

        services {

            auth {
                host=auth.protected.mdtp
                port=80
            }

            external-deskpro {
                protocol: https
                host:  deskpro-preview.tax.service.gov.uk
                port: 443
                proxy {
                  proxyRequiredForThisEnvironment=false
                }
                traceRequests: true
                traceResponses: true
                apiKey {
                  id: 2
                  code: G44HTTZZDHJ5SXD4QP4TBAW86
                }
            }
        }
    }

  hardCopyPrintTicket.retryInterval = 60 minutes

  hardCopyPrintTicket.inProgressRetryAfter = 60 minutes

  hardCopyPrintTicket.emailFrom = "noreply-hard-copy-print-request@tax.service.gov.uk"

  processTickets {
    retryInterval = 60 minutes
    inProgressRetryAfter = 60 minutes
    maxRetryCount = 168
  }

  scheduling {
    processHardCopyPrints {
      initialDelay = 1 minute
      interval = 1 minute
    }
    processTickets {
      initialDelay = 1 minute
      interval = 1 minute
    }
    collectMetrics {
      initialDelay = 1 minute
      interval = 1 minute
    }
  }

}
